<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶ú‡ßÄ‡¶¨‡¶® ‡¶∏‡ßá‡¶¨‡¶æ ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡¶ø - ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: #f0fdf4; margin: 0; padding: 10px; }
        header { background: #15803d; color: white; padding: 20px; text-align: center; border-radius: 0 0 20px 20px; margin-bottom: 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #bbf7d0; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { width: 100%; padding: 12px; background-color: #16a34a; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        button:hover { background-color: #15803d; }
        .excel-btn { background-color: #166534; margin-bottom: 20px; border: 2px solid #fff; }
        .search-box { background-color: #f0fdf4; border: 2px solid #16a34a; font-weight: bold; }
        .customer-card { background: #ffffff; padding: 15px; border-left: 8px solid #16a34a; margin-top: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .due-text { color: #dc2626; font-weight: bold; font-size: 18px; }
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }
        .btn-sm { padding: 10px; font-size: 13px; border-radius: 6px; cursor: pointer; border: none; color: white; flex: 1; min-width: 80px; font-weight: bold; }
        .bg-wa { background: #22c55e; } .bg-sms { background: #0ea5e9; } .bg-pay { background: #f59e0b; color: #000; }
        .bg-del { background: #ef4444; }
        #dashboard { display: none; }
        hr { border: 0; height: 1px; background: #dcfce7; margin: 20px 0; }
    </style>
</head>
<body>

<header>
    <h1 style="margin:0;">üåø ‡¶ú‡ßÄ‡¶¨‡¶® ‡¶∏‡ßá‡¶¨‡¶æ ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡¶ø</h1>
    <p style="margin:5px 0 0;">‡¶™‡ßç‡¶∞‡ßã: Md. Motiur Rahman (Sujal)</p>
</header>

<div class="container">
    <div id="login-form">
        <h2 style="text-align:center; color:#15803d;">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ó‡¶á‡¶®</h2>
        <input type="email" id="email" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤">
        <input type="password" id="password" placeholder="‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°">
        <button onclick="login()">‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <div id="dashboard">
        <button class="excel-btn" onclick="exportToExcel()">üìä ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶≤ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü (‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ)</button>
        
        <h3>‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ø‡ßã‡¶ó</h3>
        <input type="text" id="custName" placeholder="‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <input type="text" id="fatherName" placeholder="‡¶™‡¶ø‡¶§‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
        <input type="number" id="phone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞">
        <input type="number" id="dueAmount" placeholder="‡¶¨‡¶ï‡ßá‡ßü‡¶æ ‡¶ü‡¶æ‡¶ï‡¶æ">
        <button onclick="saveCustomer()">‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        
        <hr>
        <h3>üîç ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®</h3>
        <input type="text" id="search" class="search-box" onkeyup="searchCustomer()" placeholder="‡¶®‡¶æ‡¶Æ ‡¶¨‡¶æ ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®...">
        
        <div id="customerList">‡¶≤‡ßã‡¶°‡¶ø‡¶Ç...</div>
        
        <button onclick="logout()" style="background:#475569; margin-top:30px;">‡¶≤‡¶ó ‡¶Ü‡¶â‡¶ü</button>
    </div>
</div>

<script>
    // ‡¶Ü‡¶Æ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶∏‡¶≤ API Key ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¨‡¶∏‡¶ø‡ßü‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡¶ø
    const firebaseConfig = {
        apiKey: "AIzaSyAs-some-key-found-from-logs", // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶ø‡ßü‡ßá‡¶≤ ‡¶ï‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá
        authDomain: "pharmacy-upv2.firebaseapp.com",
        databaseURL: "https://pharmacy-upv2-default-rtdb.firebaseio.com",
        projectId: "pharmacy-upv2",
        storageBucket: "pharmacy-upv2.appspot.com",
        messagingSenderId: "1056586326177",
        appId: "1:1056586326177:web:fb09618059086e3390231d"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    function login() {
        const email = document.getElementById('email').value;
        const pass = document.getElementById('password').value;
        auth.signInWithEmailAndPassword(email, pass).then(() => {
            document.getElementById('login-form').style.display='none';
            document.getElementById('dashboard').style.display='block';
            fetchData();
        }).catch(() => alert("‡¶≠‡ßÅ‡¶≤ ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡¶æ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°!"));
    }

    function saveCustomer() {
        const name = document.getElementById('custName').value;
        const father = document.getElementById('fatherName').value;
        const phone = document.getElementById('phone').value;
        const due = parseFloat(document.getElementById('dueAmount').value);
        if(name && !isNaN(due)) {
            db.ref('customers').push({
                name: name, father: father, phone: phone, due: due, date: new Date().toLocaleDateString('bn-BD')
            });
            alert("‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            document.querySelectorAll('input:not(#search)').forEach(i => i.value = '');
        }
    }

    let excelData = [];

    function fetchData() {
        db.ref('customers').on('value', (snap) => {
            const list = document.getElementById('customerList');
            list.innerHTML = '';
            excelData = [];
            snap.forEach((child) => {
                const data = child.val();
                const id = child.key;
                excelData.push({ "‡¶®‡¶æ‡¶Æ": data.name, "‡¶™‡¶ø‡¶§‡¶æ": data.father, "‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤": data.phone, "‡¶¨‡¶ï‡ßá‡ßü‡¶æ": data.due, "‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ": data.date });
                
                list.innerHTML += `
                <div class="customer-card">
                    <b>${data.name}</b> <small>(‡¶™‡¶ø‡¶§‡¶æ: ${data.father || '‡¶®‡ßá‡¶á'})</small><br>
                    üìû ${data.phone || '‡¶®‡¶Æ‡ßç‡¶¨‡¶∞ ‡¶®‡ßá‡¶á'}<br>
                    <span class="due-text">‡¶¨‡¶æ‡¶ï‡¶ø: ${data.due} ‡¶ü‡¶æ‡¶ï‡¶æ</span><br>
                    <div class="btn-group">
                        <button class="btn-sm bg-wa" onclick="sendWA('${data.phone}', ${data.due})">WhatsApp</button>
                        <button class="btn-sm bg-pay" onclick="pay('${id}', ${data.due})">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ</button>
                        <button class="btn-sm bg-del" onclick="del('${id}')">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    </div>
                </div>`;
            });
        });
    }

    function searchCustomer() {
        let val = document.getElementById('search').value.toLowerCase();
        let cards = document.getElementsByClassName('customer-card');
        for (let i = 0; i < cards.length; i++) {
            cards[i].style.display = cards[i].innerText.toLowerCase().includes(val) ? "" : "none";
        }
    }

    function exportToExcel() {
        const ws = XLSX.utils.json_to_sheet(excelData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Baki Report");
        XLSX.writeFile(wb, "Pharmacy_Report.xlsx");
    }

    function sendWA(num, amt) { window.open(`https://wa.me/88${num}?text=‡¶ú‡ßÄ‡¶¨‡¶® ‡¶∏‡ßá‡¶¨‡¶æ ‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡¶ø: ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ï‡ßá‡ßü‡¶æ ${amt} ‡¶ü‡¶æ‡¶ï‡¶æ‡•§`); }
    
    function pay(id, current) {
        const p = parseFloat(prompt("‡¶ï‡¶§ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶≤?"));
        if(p > 0 && p <= current) db.ref('customers/' + id).update({ due: current - p });
    }

    function del(id) { if(confirm("‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?")) db.ref('customers/' + id).remove(); }
    function logout() { auth.signOut().then(() => location.reload()); }
</script>
</body>
</html>
